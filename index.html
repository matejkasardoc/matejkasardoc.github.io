<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Izkaži poznavanje KVADRATOV!</title>
    <style>
      .question-container {
        display: flex;
        flex-direction: row;
        align-items: center;
        justify-content: center;
      }
      .question {
        margin-right: 10px;
      }
    </style>
  </head>
  <body>
    <h1>KVADRATI</h1>
    <p>V okvirček vpiši svoj odgovor in pritisni na vnosnico (tipko Enter).</p>
    <div class="question-container">
      <p class="question" id="question"></p>
      <input type="text" id="answer" onkeyup="checkAnswer(event)" autofocus>
    </div>
    <div id="score" style="display: none;">
      <p>Pravilno si odgovoril na <span id="numCorrect"></span> od <span id="numQuestions"></span> vprašanj v <span id="timeTaken"></span> sekundah.</p>
      <div id="answers"></div>
      <button id="tryAgainBtn">Poskusi znova</button>
    </div>
    <script>
  const MIN_SQUARE = 0;
  const MAX_SQUARE_1 = 10;
  const MAX_SQUARE_2 = 20;
  const MAX_SQUARE_3 = 25;
  const NUM_QUESTIONS = 10;

  let numCorrect = 0;
  let numQuestions = 0;
  let startTime = 0;
  let question = '';

  function init() {
    document.getElementById('tryAgainBtn').addEventListener('click', resetGame);
    askQuestion();
  }

  function askQuestion() {
    if (numQuestions < NUM_QUESTIONS) {
      let square;
      const random = Math.random();
      if (random < 0.6) {
        square = Math.floor(Math.random() * (MAX_SQUARE_2 - MAX_SQUARE_1 + 1) + MAX_SQUARE_1);
      } else if (random < 0.8) {
        square = Math.floor(Math.random() * (MAX_SQUARE_3 - MAX_SQUARE_2 + 1) + MAX_SQUARE_2);
      } else {
        square = Math.floor(Math.random() * (MAX_SQUARE_1 - MIN_SQUARE + 1) + MIN_SQUARE);
      }
      question = `Koliko je ${square}²?`;
      document.getElementById('question').textContent = question;
      numQuestions++;
      document.getElementById('answer').value = '';
      document.getElementById('answer').focus();
      if (numQuestions === 1) {
        startTime = new Date().getTime();
      }
    }  else {
      const endTime = new Date().getTime();
      const timeTaken = ((endTime - startTime) / 1000).toFixed(2);
      document.getElementById('numCorrect').textContent = numCorrect;
      document.getElementById('numQuestions').textContent = NUM_QUESTIONS;
      document.getElementById('timeTaken').textContent = timeTaken;
      document.getElementById('score').style.display = 'block';
      document.getElementById('answer').removeEventListener('keyup', checkAnswer);
      document.getElementById('answersList').style.display = 'block';
      document.getElementById('answersList').textContent = getAnswersList();
    }
  }

  function checkAnswer(event) {
    if (event.keyCode === 13) {
      const answer = parseInt(document.getElementById('answer').value);
      if (!isNaN(answer)) {
        const square = parseInt(question.match(/\d+/g)[0]);
        if (answer === square ** 2) {
          numCorrect++;
        }
        document.getElementById('answersList').innerHTML += `<li><strong>Vprašanje:</strong> ${question} <strong>Tvoj odgovor:</strong> ${answer} <strong>Pravilni odgovor:</strong> ${square ** 2}</li>`;
        askQuestion();
      }
    }
  }

  function resetGame() {
    numCorrect = 0;
    numQuestions = 0;
    startTime = 0;
    question = '';
    document.getElementById('score').style.display = 'none';
    document.getElementById('answersList').style.display = 'none';
    document.getElementById('answersList').innerHTML = '';
    askQuestion();
  }

  function getAnswersList() {
    let answersList = '';
    const answers = document.querySelectorAll('#answersList li');
    answers.forEach((answer) => {
      answersList += answer.innerHTML + '<br>';
    });
    return answersList;
  }
  init();
</script>
  </body>
</html>
